---
title: "Data550 Final Dataset"
author: "Mia Yang"
date: "`r Sys.Date()`"
output: html_document
---

# Final Project: Modeling Medical Insurance Charges Using Demographic and Lifestyle Factors


```{r setup, include=FALSE}
library(knitr)

# Set global chunk options
opts_chunk$set(
  echo = FALSE,      
  warning = FALSE,   
  message = FALSE    
)
```

*Besides the loading data code chunk, all other codes used to generate the table 1 and the boxplot will not be included in the report but will be in the .rmd file.*

# 1. Introduction:


## 1.1 Dataset 


My dataset was chosen from *[kaggle](www.kaggle.com)* and it is a *[Medical Insurance Cost dataset](https://www.kaggle.com/datasets/mosapabdelghany/medical-insurance-cost-dataset)*.(Click on italic text to see the website and the data). 

```{r, load-data, echo = TRUE}

absolute_path_data_final <- here::here("Data550_Final/raw_data/insurance.csv")

final_data <- read.csv(absolute_path_data_final, header = TRUE)

head(final_data)
```

## 1.2 Objective of this Project:


Health insurance costs are influenced by a range of demographic and lifestyle characteristics, such as age, sex, body mass index (BMI), smoking status, and geographic region. Understanding how these factors contribute to medical expenses can provide valuable insights for health policy, insurance providers, and individuals seeking affordable care.


## 1.3 Description of the Data: 


The dataset used in this analysis, the Medical Insurance Cost Dataset (sourced from Kaggle), contains records for 1,338 individuals. Each record includes demographic variables (age, sex, region), lifestyle indicators (BMI, smoking status, number of children), and the corresponding insurance charges billed to the individual. This dataset is widely used for teaching statistical modeling and health economics because it offers a structured, real-world–inspired look at cost variation.


# 2. Descriptive Analysis:

## 2.1 Table 1:

Characteristics of the `r nrow(final_data)`  data points from the insurance database are displayed in the table below.



```{r}

library(gtsummary)
library(dplyr)
library(gt)


final_data <- final_data %>%
  mutate(charge_group = ifelse(charges > median(charges), "High", "Low"))

table_one <- final_data %>%
  select(age, sex, bmi, children, region, smoker, charge_group) %>%
  tbl_summary(
    by = charge_group,
    statistic = list(
      all_continuous() ~ "{median} ({p25}, {p75})",
      all_categorical() ~ "{n} ({p}%)"
    ),
    missing = "no"
  ) %>%
  add_overall() %>%
  add_p() %>%
  modify_spanning_header(all_stat_cols() ~ "**By Insurance Charges (High vs Low)**") %>%
  bold_labels()

table_one
gtsave(
  as_gt(table_one),
  filename = here::here("Data550_Final/output/table_one.png")
)


```

## Table 1 Analysis:


Table 1 summarizes the baseline characteristics of the study population (N = 1,338) stratified by insurance charges categorized as high versus low (above vs. below the median). Individuals in the high-charge group tended to be older, with a median age of 51 years compared to 31 years in the low-charge group (p < 0.001). BMI was also higher among those with high charges (median 31.1 vs. 29.9, p = 0.001). The distribution of sex was similar across groups (approximately half male and half female, p > 0.9). The number of children showed some differences, with the high-charge group slightly more likely to have three or more children (p = 0.016). Regional distribution did not differ significantly (p = 0.2). Notably, smoking status showed the strongest association with charges: 41% of the high-charge group were smokers, compared to none in the low-charge group (p < 0.001). These findings suggest that age, BMI, number of children, and smoking status are important predictors of higher insurance costs.


## 2.2 Boxplot of the Charges by Region

```{r}

library(ggplot2)

boxplot_reg <- ggplot(final_data, aes(x = region, y = charges)) +
  geom_boxplot(fill = "lightblue", alpha = 0.7) +
  labs(
    title = "Distribution of Insurance Charges by Region",
    x = "Region",
    y = "Insurance Charges (USD)"
  ) +
  scale_y_continuous(labels = scales::dollar_format())

ggsave(
  here::here("Data550_Final/output/boxplot.png"),
  plot = boxplot_reg,
  device = "png"
  
)

boxplot_reg


```

## Boxplot by region Analysis:

The boxplot was created to examine whether geographic region is associated with differences in insurance charges. Region is a categorical factor in the dataset, and plotting charges across the four regions (northeast, northwest, southeast, and southwest) allows for a visual comparison of central tendencies, spread, and outliers. From the plot, we can see that the overall distributions of charges are broadly similar across regions, with medians clustering around comparable levels. However, the southeast region shows a slightly higher median and wider interquartile range compared to other regions, suggesting greater variability in charges. All regions exhibit numerous high-cost outliers, reflecting individuals with extremely high insurance expenses. This visualization suggests that while region may play some role in cost variability, other factors—such as smoking status, BMI, or age—are likely stronger predictors of differences in insurance charges.
